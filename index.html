<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>筋トレ究極カスタム</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #1a1a1a; color: #fff; font-family: sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        h1 { font-size: 18px; color: #f1c40f; margin: 5px 0; }
        .counter { font-size: 14px; color: #2ecc71; margin-bottom: 10px; }
        
        .body-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 400px; }
        .muscle-btn { background-color: #333; color: #fff; border: 2px solid #555; border-radius: 10px; padding: 10px; min-height: 70px; cursor: pointer; }
        .muscle-btn.completed { background-color: #e74c3c; border-color: #ff7675; }
        .muscle-name { font-weight: bold; font-size: 16px; }
        .muscle-info { font-size: 11px; opacity: 0.8; }

        .input-panel { background: #222; padding: 15px; border-radius: 10px; width: 100%; max-width: 400px; margin-top: 15px; box-sizing: border-box; }
        .input-row { display: flex; align-items: center; margin-bottom: 12px; justify-content: space-between; gap: 10px; }
        
        /* 種目名の入力欄（カスタム可能） */
        .menu-name-input { background: #444; color: #fff; border: 1px dashed #777; padding: 5px; border-radius: 4px; flex: 1; font-size: 14px; }
        .weight-input { width: 70px; padding: 8px; text-align: center; border-radius: 4px; border: none; font-size: 18px; font-weight: bold; }

        .action-btn { width: 100%; max-width: 400px; padding: 15px; margin-top: 10px; border-radius: 8px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; }
        .save-btn { background-color: #27ae60; color: white; }
        .nav-btn { background-color: #3498db; color: white; }
        .del-btn { background-color: #c0392b; color: white; font-size: 12px; padding: 5px; margin-left: 10px; border-radius: 4px; }

        .screen { display: none; width: 100%; max-width: 400px; }
        .active { display: flex; flex-direction: column; }
        .history-item { background: #333; margin: 8px 0; padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.4; border-left: 4px solid #f1c40f; }
        canvas { background: #fff; border-radius: 10px; margin-top: 10px; }
        .hint { font-size: 10px; color: #999; text-align: center; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div id="main-screen" class="screen active">
        <h1>筋トレ記録</h1>
        <div id="total-count" class="counter">全種コンプリート回数: 0回</div>
        
        <div class="body-container">
            <button class="muscle-btn" id="btn-chest" onclick="selectPart('胸')"><div class="muscle-name">胸</div><div class="muscle-info" id="info-胸">-</div></button>
            <button class="muscle-btn" id="btn-back" onclick="selectPart('背中')"><div class="muscle-name">背中</div><div class="muscle-info" id="info-背中">-</div></button>
            <button class="muscle-btn" id="btn-shoulder" onclick="selectPart('肩')"><div class="muscle-name">肩</div><div class="muscle-info" id="info-肩">-</div></button>
            <button class="muscle-btn" id="btn-arm" onclick="selectPart('腕')"><div class="muscle-name">腕</div><div class="muscle-info" id="info-腕">-</div></button>
            <button class="muscle-btn" id="btn-leg" onclick="selectPart('脚')"><div class="muscle-name">脚</div><div class="muscle-info" id="info-脚">-</div></button>
        </div>

        <div class="input-panel">
            <div id="selected-part-label" style="color:#f1c40f; font-weight:bold; margin-bottom:5px;">部位を選択してください</div>
            <div class="hint">※種目名をタップして変更できます</div>
            <div class="input-row">
                <input type="text" id="menu1-name" class="menu-name-input" placeholder="種目1" onchange="saveConfig()">
                <input type="number" id="weight1" class="weight-input" value="0"> kg
            </div>
            <div class="input-row">
                <input type="text" id="menu2-name" class="menu-name-input" placeholder="種目2" onchange="saveConfig()">
                <input type="number" id="weight2" class="weight-input" value="0"> kg
            </div>
            <button class="action-btn save-btn" onclick="recordWorkout()">この部位を記録して保存</button>
        </div>

        <button class="action-btn nav-btn" onclick="showScreen('history-screen')">履歴・グラフを見る</button>
    </div>

    <div id="history-screen" class="screen">
        <h1>履歴と最高重量グラフ</h1>
        <select id="graph-select" onchange="updateChart()" style="width:100%; padding:10px; margin-bottom:10px; border-radius:5px; background:#444; color:#fff; border:none;"></select>
        <canvas id="weightChart" width="400" height="300"></canvas>
        <div id="history-list" style="margin-top:20px;"></div>
        <button class="action-btn nav-btn" style="background:#95a5a6" onclick="showScreen('main-screen')">戻る</button>
    </div>

    <script>
        // デフォルト設定
        const defaultMenus = {
            胸: ["ベンチプレス", "フライ"],
            背中: ["デッドリフト", "ラットプル"],
            肩: ["サイドレイズ", "プレス"],
            腕: ["カール", "ダウン"],
            脚: ["スクワット", "プレス"]
        };

        let currentPart = null;
        // データの統合
        let userData = JSON.parse(localStorage.getItem('workout_v4') || JSON.stringify({
            history: [], 
            status: {}, 
            compCount: 0, 
            config: defaultMenus
        }));

        updateUI();

        function selectPart(part) {
            currentPart = part;
            document.getElementById('selected-part-label').innerText = `【${part}】のトレーニング`;
            document.getElementById('menu1-name').value = userData.config[part][0];
            document.getElementById('menu2-name').value = userData.config[part][1];
            document.getElementById('weight1').value = userData.status[part]?.w1 || 0;
            document.getElementById('weight2').value = userData.status[part]?.w2 || 0;
        }

        // 種目名の変更を保存
        function saveConfig() {
            if(!currentPart) return;
            userData.config[currentPart][0] = document.getElementById('menu1-name').value;
            userData.config[currentPart][1] = document.getElementById('menu2-name').value;
            save();
        }

        function recordWorkout() {
            if(!currentPart) return alert("部位を選んでください");
            
            const m1 = document.getElementById('menu1-name').value;
            const m2 = document.getElementById('menu2-name').value;
            const w1 = parseFloat(document.getElementById('weight1').value);
            const w2 = parseFloat(document.getElementById('weight2').value);
            const dateStr = new Date().toLocaleDateString('ja-JP');

            userData.history.push({
                id: Date.now(),
                date: dateStr,
                part: currentPart,
                m1: m1, w1: w1,
                m2: m2, w2: w2
            });

            userData.status[currentPart] = { completed: true, w1: w1, w2: w2 };

            // 全部位チェック
            const parts = Object.keys(defaultMenus);
            const allDone = parts.every(p => userData.status[p]?.completed);
            if(allDone) {
                userData.compCount++;
                alert("全コンプリート達成！おめでとうございます！");
                parts.forEach(p => userData.status[p].completed = false);
            }

            save();
            updateUI();
        }

        function deleteHistory(id) {
            if(!confirm("この記録を削除しますか？")) return;
            userData.history = userData.history.filter(h => h.id !== id);
            save();
            renderHistory();
            updateChart();
        }

        function save() { localStorage.setItem('workout_v4', JSON.stringify(userData)); }

        function updateUI() {
            document.getElementById('total-count').innerText = `全種コンプリート回数: ${userData.compCount}回`;
            Object.keys(defaultMenus).forEach(p => {
                const btn = document.getElementById(`btn-${p}`);
                const info = document.getElementById(`info-${p}`);
                if(userData.status[p]?.completed) btn.classList.add('completed');
                else btn.classList.remove('completed');
                info.innerText = userData.status[p] ? `${userData.status[p].w1}/${userData.status[p].w2}kg` : "-";
            });
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'history-screen') {
                updateGraphList();
                renderHistory();
                updateChart();
            }
        }

        function updateGraphList() {
            const select = document.getElementById('graph-select');
            select.innerHTML = "";
            Object.keys(userData.config).forEach(p => {
                select.innerHTML += `<option value="${p}_1">${p}: ${userData.config[p][0]}</option>`;
                select.innerHTML += `<option value="${p}_2">${p}: ${userData.config[p][1]}</option>`;
            });
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = "<h3>最近の履歴</h3>";
            userData.history.slice().reverse().forEach(h => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <strong>${h.date} - ${h.part}</strong><br>
                    ${h.m1}: ${h.w1}kg / ${h.m2}: ${h.w2}kg
                    <button class="del-btn" onclick="deleteHistory(${h.id})">削除</button>
                `;
                list.appendChild(item);
            });
        }

        let myChart = null;
        function updateChart() {
            const select = document.getElementById('graph-select');
            if(!select.value) return;
            const [part, menuIdx] = select.value.split('_');
            const weightKey = menuIdx === '1' ? 'w1' : 'w2';
            const nameKey = menuIdx === '1' ? 'm1' : 'm2';

            const filtered = userData.history.filter(h => h.part === part);
            const labels = filtered.map(h => h.date);
            const values = filtered.map(h => h[weightKey]);
            const menuName = userData.config[part][parseInt(menuIdx)-1];

            const ctx = document.getElementById('weightChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${menuName} (kg)`,
                        data: values,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        fill: true, tension: 0.1
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        }
    </script>
</body>
</html>